# Cave-Escape 要件定義書

## 1. プロジェクト概要

### 1.1 プロジェクト名
Cave-Escape

### 1.2 プロジェクト概要
横スクロール（左から右）アクションゲーム。洞窟を進むロケットを操作し、壁に接触することなく目標距離まで進むワンボタンゲーム。

### 1.3 目的
シンプルな操作で楽しめるアクションゲームの提供。GitHub Pagesでの公開を想定。

## 2. ゲーム仕様

### 2.1 基本ルール
- **操作方法**: スペースキーのみ
  - スペースキー押下中: ロケット上昇
  - スペースキー離す: ロケット下降
  - ロケットは画面左側に配置、右を向いている
- **ゲームオーバー条件**: ロケットが洞窟の壁に接触
- **クリア条件**: 各ステージの目標距離（2000km）に到達
- **スコア**: 進んだ距離（km）で表示
 - **距離単位・換算**: ゲーム内 1px = 10m（1km = 100px）。表示はkm、小数1桁で丸め（例: 12.3km）。
 - **クリア距離の実装値**: 2000km = 200,000px（各ステージ）。

### 2.2 物理特性
- **重力**: スペースキーを離すと放物線を描いて下降
- **上昇力**: スペースキー押下中は放物線を描いて上昇
- **慣性**: あり（物理的な動きを再現）

### 2.4 ステージ実数パラメータ（初期値/調整後）
- **スクロール速度(px/s)**: [900, 1000, 1200, 1400, 1600]
- **最小ギャップ幅(px)**: [340, 300, 260, 220, 200]
- **目標クリア時間目安**: 各ステージ 2〜4 分（200,000px ÷ 速度）
- **最小マージン**: 上下端から各20pxを確保（中心範囲を制限）
- **カーブ制約（推奨）**: 洞窟中心線の傾斜を100pxあたりの上下変化量で制御
  - 上限(px/100px): [25, 35, 45, 55, 60]（ステージ1→5）
- **生成周期の目安（中心線の基本周期）**: [800, 700, 600, 520, 480] px（ノイズ合成＋最小ギャップ保証）
- **微揺らぎ**: 速度/ギャップを±10%以内で短周期変動（理不尽回避のためクランプ）

### 2.3 ステージ構成（全5ステージ）

| ステージ | 速度 | 高さ上限 | 壁の間隔 | 特徴 |
|---------|------|----------|----------|------|
| 1 | 1 | 1 | とても広い | チュートリアル |
| 2 | 1 | 2 | 広い | 高さ制限追加 |
| 3 | 4 | 2 | 広い | 高速スクロール |
| 4 | 2 | 4 | 狭い | 複雑な壁パターン |
| 5 | 3 | 5 | とても狭い | 最終ステージ |

**各ステージの目標距離**: 2000km

## 3. 技術仕様

### 3.1 技術スタック
- **フロントエンド**: HTML5 + CSS3 + JavaScript (Vanilla JS)
- **描画**: HTML5 Canvas
- **音声**: Web Audio API
- **デプロイ**: GitHub Pages

### 3.2 対応ブラウザ
- Chrome (最新版)
- Firefox (最新版)
- Safari (最新版)
- Edge (最新版)

### 3.3 画面/解像度
- **Canvas解像度**: 800x450（16:9）固定。
- **表示方式**: アスペクト比固定でレターボックス。拡大縮小はCSSスケール。
- **座標系**: 論理解像度は常に800x450（デバイスピクセル比に依存しない）。

## 4. 機能要件

### 4.1 ゲームエンジン
- 60FPSでのゲームループ
- フレームレート独立の物理演算
- 当たり判定システム
 - 固定タイムステップ: Δt = 1/60s（大きなフレーム落ち時はΔtを2フレーム分までクランプ）

### 4.2 ロケットシステム
- 物理演算による移動（重力・慣性）
- スペースキー入力の検知
- 壁との当たり判定
 - 当たり判定形状: 多角形（8頂点程度の凸ポリゴン）
 - 速度上限: 垂直速度 |Vy| ≤ 1200 px/s（初期値）
 - 物理パラメータ（初期値）: 重力 g = 1800 px/s^2、推力 a = 2400 px/s^2

### 4.3 洞窟システム
- ランダム生成による壁パターン
- ステージごとの難易度調整
- 右スクロール実装
 - 生成方式: 低周波ノイズ＋サイン波の合成で上下境界を生成し、最小ギャップ幅を常に保証。
 - 当たり判定: ポリゴン境界（上下境界をポリラインとして保持）。
 - 判定手法: SAT（分離軸定理）による多角形-多角形/多角形-線分判定。
 - 乱数シード: 任意で固定可能（再現性テスト用）。

### 4.4 ステージシステム
- 5ステージの段階的難易度上昇
- ステージ進行の管理
- クリア条件の判定

### 4.5 視覚効果
- **パーティクル効果**: 爆発時のエフェクト
- **背景スクロール**: ステージごとに雰囲気・色を変更
- **ロケット炎エフェクト**: 上昇時の炎の描画

### 4.6 音声システム
- **効果音**: 爆発音、エンジン音
- **BGM**: ステージごとの音楽（オプション）
- **音量調整**: 可能
 - **ミュート切替**: UIからON/OFF可能（初期値: SFX 80%, BGM 60%）

### 4.7 UI要素
- **スコア表示**: 現在の距離（km）
- **ステージ表示**: 現在のステージ番号
- **ゲームオーバー画面**: スコア表示、リスタートボタン
- **クリア画面**: ステージクリア表示、次ステージボタン
- **タイトル画面**: ゲーム開始画面
 - **オプション**: 音量・ミュート設定、ベスト距離のリセット（任意）

## 5. 非機能要件

### 5.1 パフォーマンス
- 60FPSでの安定した動作
- メモリ使用量の最適化
- ローディング時間の短縮
 - パーティクル上限: 300個程度（状況により可変）

### 5.2 ユーザビリティ
- 直感的な操作
- 明確なフィードバック
- レスポンシブデザイン（画面サイズ対応）

### 5.3 互換性
- GitHub Pagesでの正常動作
- モバイルブラウザでの基本動作
 - モバイル入力: 画面タップ長押しで上昇（任意対応、オーディオの初回解放に利用）

### 5.4 データ保存
- 保存先: `localStorage`
- 保存内容: ベスト距離（各ステージ）、音量/ミュート設定

## 6. ファイル構成

```
Cave-Escape/
├── index.html              # メインHTMLファイル
├── css/
│   └── style.css           # スタイルシート
├── js/
│   ├── main.js             # メインゲームロジック
│   ├── game.js             # ゲームエンジン
│   ├── rocket.js           # ロケットクラス
│   ├── cave.js             # 洞窟生成クラス
│   ├── stage.js            # ステージ管理クラス
│   ├── particle.js         # パーティクルシステム
│   ├── audio.js            # 音声管理クラス
│   └── ui.js               # UI管理クラス
├── assets/
│   └── sounds/             # 音声ファイル
│       ├── explosion.wav   # 爆発音
│       ├── engine.wav      # エンジン音
│       └── bgm/            # BGMファイル
├── docs/
│   └── requirements.md     # 要件定義書
└── README.md               # プロジェクト説明
```

## 7. 開発スケジュール

### Phase 1: 基盤開発
- プロジェクト構造作成
- 基本ゲームエンジン実装
- ロケットの物理演算実装

### Phase 2: ゲームロジック
- 洞窟生成システム実装
- 当たり判定システム実装
- ステージシステム実装

### Phase 3: 視覚・音響効果
- パーティクルシステム実装
- 音声システム実装
- 背景・エフェクト実装

### Phase 4: UI・完成
- UI要素実装
- ゲームバランス調整
- テスト・デバッグ

## 8. 承認事項

- [ ] ゲーム仕様の承認
- [ ] 技術仕様の承認
- [ ] 機能要件の承認
- [ ] ファイル構成の承認
- [ ] 開発スケジュールの承認

---

**作成日**: 2025年10月19日  
**バージョン**: 1.0  
**承認者**: [承認者名]  
**承認日**: [承認日]
